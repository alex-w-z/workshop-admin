"use strict";var le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z={exports:{}};const me=e=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const t=crypto.getRandomValues(new Uint8Array(1))[0];return(t>=e?t%e:t).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),re=(e=7,t=!1)=>Array.from({length:e},me(t?16:36)).join("");Z.exports=re;Z.exports.default=re;var ce=Z.exports;const W=ee(ce);var de=()=>`uid::${W(7)}`,Ae=(e,t=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&t.every(r=>r in e),ue=e=>{try{const t=JSON.parse(e);return Ae(t)?t:null}catch{return null}},fe=()=>{let e=[];return{add:(...t)=>{e=[...e,...t]},remove:t=>{e=typeof t=="string"?e.filter(r=>r.message.transactionId!==t):e.filter(r=>!t.includes(r))},entries:()=>e}},F=class{static toBackground(e,t){return e.postMessage(t)}static toExtensionContext(e,t){return e.postMessage(t)}},pe=Object.defineProperty,xe=Object.defineProperties,be=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,he=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,X=(e,t,r)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,T=(e,t)=>{for(var r in t||(t={}))he.call(t,r)&&X(e,r,t[r]);if(Q)for(var r of Q(t))ye.call(t,r)&&X(e,r,t[r]);return e},H=(e,t)=>xe(e,be(t)),we=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,K=e=>{const[,t,r,l]=e.match(we)||[];return{context:t,tabId:+r,frameId:l?+l:void 0}},B=({context:e,tabId:t,frameId:r})=>["background","popup","options"].includes(e)?e:`${e}@${t}${r?`.${r}`:""}`;const ve=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],V=Symbol(".toJSON was called"),Ee=e=>{e[V]=!0;const t=e.toJSON();return delete e[V],t},te=({from:e,seen:t,to_:r,forceEnumerable:l,maxDepth:g,depth:s})=>{const n=r||(Array.isArray(e)?[]:{});if(t.push(e),s>=g)return n;if(typeof e.toJSON=="function"&&e[V]!==!0)return Ee(e);for(const[o,c]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(c)){n[o]="[object Buffer]";continue}if(c!==null&&typeof c=="object"&&typeof c.pipe=="function"){n[o]="[object Stream]";continue}if(typeof c!="function"){if(!c||typeof c!="object"){n[o]=c;continue}if(!t.includes(e[o])){s++,n[o]=te({from:e[o],seen:[...t],forceEnumerable:l,maxDepth:g,depth:s});continue}n[o]="[Circular]"}}for(const{property:o,enumerable:c}of ve)typeof e[o]=="string"&&Object.defineProperty(n,o,{value:e[o],enumerable:l?!0:c,configurable:!0,writable:!0});return n};function _e(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return typeof e=="object"&&e!==null?te({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}let ne=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach(r=>r(...t))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter(r=>r!==t)}});var Se=(e,t,r)=>{const l=W(),g=new Map,s=new Map,n=o=>{if(o.destination.context===e&&!o.destination.frameId&&!o.destination.tabId){r==null||r(o);const{transactionId:c,messageID:x,messageType:u}=o,E=()=>{const h=g.get(c);if(h){const{err:f,data:C}=o;if(f){const y=f,L=self[y.name],j=new(typeof L=="function"?L:Error)(y.message);for(const D in y)j[D]=y[D];h.reject(j)}else h.resolve(C);g.delete(c)}},k=async()=>{let h,f,C=!1;try{const y=s.get(x);if(typeof y=="function")h=await y({sender:o.origin,id:x,data:o.data,timestamp:o.timestamp});else throw C=!0,new Error(`[webext-bridge] No handler registered in '${e}' to accept messages with id '${x}'`)}catch(y){f=y}finally{if(f&&(o.err=_e(f)),n(H(T({},o),{messageType:"reply",data:h,origin:{context:e,tabId:null},destination:o.origin,hops:[]})),f&&!C)throw h}};switch(u){case"reply":return E();case"message":return k()}}return o.hops.push(`${e}::${l}`),t(o)};return{handleMessage:n,endTransaction:o=>{const c=g.get(o);c==null||c.reject("Transaction was ended before it could complete"),g.delete(o)},sendMessage:(o,c,x="background")=>{const u=typeof x=="string"?K(x):x,E="Bridge#sendMessage ->";if(!u.context)throw new TypeError(`${E} Destination must be any one of known destinations`);return new Promise((k,h)=>{const f={messageID:o,data:c,destination:u,messageType:"message",transactionId:W(),origin:{context:e,tabId:null},hops:[],timestamp:Date.now()};g.set(f.transactionId,{resolve:k,reject:h});try{n(f)}catch(C){g.delete(f.transactionId),h(C)}})},onMessage:(o,c)=>(s.set(o,c),()=>s.delete(o))}},N=class{constructor(e,t){this.endpointRuntime=e,this.streamInfo=t,this.emitter=ne(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},N.initDone||(e.onMessage("__crx_bridge_stream_transfer__",r=>{const{streamId:l,streamTransfer:g,action:s}=r.data,n=N.openStreams.get(l);n&&!n.isClosed&&(s==="transfer"&&n.emitter.emit("message",g),s==="close"&&(N.openStreams.delete(l),n.handleStreamClose()))}),N.initDone=!0),N.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:e,action:"transfer"},this.streamInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,t){const r=this.emitter.on(e,t);return Object.assign(r,{dispose:r,close:r})}},U=N;U.initDone=!1;U.openStreams=new Map;var Ce=e=>{const t=new Map,r=new Map,l=ne();e.onMessage("__crx_bridge_stream_open__",n=>new Promise(o=>{const{sender:c,data:x}=n,{channel:u}=x;let E=!1,k=()=>{};const h=()=>{const f=r.get(u);typeof f=="function"?(f(new U(e,H(T({},x),{endpoint:c}))),E&&k(),o(!0)):E||(E=!0,k=l.on("did-change-stream-callbacks",h))};h()}));async function g(n,o){if(t.has(n))throw new Error("webext-bridge: A Stream is already open at this channel");const c=typeof o=="string"?K(o):o,x={streamId:W(),channel:n,endpoint:c},u=new U(e,x);return u.onClose(()=>t.delete(n)),await e.sendMessage("__crx_bridge_stream_open__",x,c),t.set(n,u),u}function s(n,o){if(r.has(n))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");r.set(n,o),l.emit("did-change-stream-callbacks")}return{openStream:g,onOpenStreamChannel:s}},se={exports:{}};(function(e,t){(function(r,l){l(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:le,function(r){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const l="The message port closed before a response was received.",g="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",s=n=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(a,d=void 0){super(d),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const x=i=>i&&typeof i=="object"&&typeof i.then=="function",u=(i,a)=>(...d)=>{n.runtime.lastError?i.reject(new Error(n.runtime.lastError.message)):a.singleCallbackArg||d.length<=1&&a.singleCallbackArg!==!1?i.resolve(d[0]):i.resolve(d)},E=i=>i==1?"argument":"arguments",k=(i,a)=>function(A,...b){if(b.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${E(a.minArgs)} for ${i}(), got ${b.length}`);if(b.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${E(a.maxArgs)} for ${i}(), got ${b.length}`);return new Promise((w,_)=>{if(a.fallbackToNoCallback)try{A[i](...b,u({resolve:w,reject:_},a))}catch(m){console.warn(`${i} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,m),A[i](...b),a.fallbackToNoCallback=!1,a.noCallback=!0,w()}else a.noCallback?(A[i](...b),w()):A[i](...b,u({resolve:w,reject:_},a))})},h=(i,a,d)=>new Proxy(a,{apply(A,b,w){return d.call(b,i,...w)}});let f=Function.call.bind(Object.prototype.hasOwnProperty);const C=(i,a={},d={})=>{let A=Object.create(null),b={has(_,m){return m in i||m in A},get(_,m,S){if(m in A)return A[m];if(!(m in i))return;let p=i[m];if(typeof p=="function")if(typeof a[m]=="function")p=h(i,i[m],a[m]);else if(f(d,m)){let P=k(m,d[m]);p=h(i,i[m],P)}else p=p.bind(i);else if(typeof p=="object"&&p!==null&&(f(a,m)||f(d,m)))p=C(p,a[m],d[m]);else if(f(d,"*"))p=C(p,a[m],d["*"]);else return Object.defineProperty(A,m,{configurable:!0,enumerable:!0,get(){return i[m]},set(P){i[m]=P}}),p;return A[m]=p,p},set(_,m,S,p){return m in A?A[m]=S:i[m]=S,!0},defineProperty(_,m,S){return Reflect.defineProperty(A,m,S)},deleteProperty(_,m){return Reflect.deleteProperty(A,m)}},w=Object.create(i);return new Proxy(w,b)},y=i=>({addListener(a,d,...A){a.addListener(i.get(d),...A)},hasListener(a,d){return a.hasListener(i.get(d))},removeListener(a,d){a.removeListener(i.get(d))}}),L=new c(i=>typeof i!="function"?i:function(d){const A=C(d,{},{getContent:{minArgs:0,maxArgs:0}});i(A)});let j=!1;const D=new c(i=>typeof i!="function"?i:function(d,A,b){let w=!1,_,m=new Promise(R=>{_=function(I){j||(console.warn(g,new Error().stack),j=!0),w=!0,R(I)}}),S;try{S=i(d,A,_)}catch(R){S=Promise.reject(R)}const p=S!==!0&&x(S);if(S!==!0&&!p&&!w)return!1;const P=R=>{R.then(I=>{b(I)},I=>{let J;I&&(I instanceof Error||typeof I.message=="string")?J=I.message:J="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:J})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return P(p?S:m),!0}),ae=({reject:i,resolve:a},d)=>{n.runtime.lastError?n.runtime.lastError.message===l?a():i(new Error(n.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?i(new Error(d.message)):a(d)},Y=(i,a,d,...A)=>{if(A.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${E(a.minArgs)} for ${i}(), got ${A.length}`);if(A.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${E(a.maxArgs)} for ${i}(), got ${A.length}`);return new Promise((b,w)=>{const _=ae.bind(null,{resolve:b,reject:w});A.push(_),d.sendMessage(...A)})},ge={devtools:{network:{onRequestFinished:y(L)}},runtime:{onMessage:y(D),onMessageExternal:y(D),sendMessage:Y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},z={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":z},services:{"*":z},websites:{"*":z}},C(n,ge,o)};r.exports=s(chrome)}else r.exports=globalThis.browser})})(se);var Ie=se.exports;const ke=ee(Ie);var $=fe(),v=new Map,O=new Map,q=new Map,oe=(e,t)=>(O.set(e,(O.get(e)||new Set).add(t)),()=>{const r=O.get(e);r!=null&&r.delete(t)&&(r==null?void 0:r.size)===0&&O.delete(e)}),ie=(e,t)=>{q.set(e,(q.get(e)||new Set).add(t))},M=e=>({withFingerprint:t=>{const r=g=>({and:()=>g}),l={aboutIncomingMessage:g=>{const s=v.get(e);return F.toExtensionContext(s.port,{status:"incoming",message:g}),r(l)},aboutSuccessfulDelivery:g=>{const s=v.get(e);return F.toExtensionContext(s.port,{status:"delivered",receipt:g}),r(l)},aboutMessageUndeliverability:(g,s)=>{const n=v.get(e);return(n==null?void 0:n.fingerprint)===t&&F.toExtensionContext(n.port,{status:"undeliverable",resolvedDestination:g,message:s}),r(l)},whenDeliverableTo:g=>{const s=()=>{const n=v.get(e);if((n==null?void 0:n.fingerprint)===t&&v.has(g))return F.toExtensionContext(n.port,{status:"deliverable",deliverableTo:g}),!0};if(!s()){const n=oe(g,s);ie(t,n)}return r(l)},aboutSessionEnded:g=>{const s=v.get(e);return(s==null?void 0:s.fingerprint)===t&&F.toExtensionContext(s.port,{status:"terminated",fingerprint:g}),r(l)}};return l}}),Te=de(),G=Se("background",e=>{var t;if(e.origin.context==="background"&&["content-script","devtools "].includes(e.destination.context)&&!e.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const r=B(T(T({},e.origin),e.origin.context==="window"&&{context:"content-script"})),l=B(H(T(T({},e.destination),e.destination.context==="window"&&{context:"content-script"}),{tabId:e.destination.tabId||e.origin.tabId}));e.destination.tabId=null,e.destination.frameId=null;const g=()=>v.get(l),s=()=>v.get(r),n=()=>{var o;M(l).withFingerprint(g().fingerprint).aboutIncomingMessage(e);const c={message:e,to:g().fingerprint,from:{endpointId:r,fingerprint:(o=s())==null?void 0:o.fingerprint}};e.messageType==="message"&&$.add(c),e.messageType==="reply"&&$.remove(e.messageID),s()&&M(r).withFingerprint(s().fingerprint).aboutSuccessfulDelivery(c)};(t=g())!=null&&t.port?n():e.messageType==="message"&&(e.origin.context==="background"?oe(l,n):s()&&M(r).withFingerprint(s().fingerprint).aboutMessageUndeliverability(l,e).and().whenDeliverableTo(l))},e=>{const t=B(T(T({},e.origin),e.origin.context==="window"&&{context:"content-script"})),r=v.get(t),l={message:e,to:Te,from:{endpointId:t,fingerprint:r.fingerprint}};M(t).withFingerprint(r.fingerprint).aboutSuccessfulDelivery(l)});ke.runtime.onConnect.addListener(e=>{var t;const r=ue(e.name);if(!r)return;r.endpointName||(r.endpointName=B({context:"content-script",tabId:e.sender.tab.id,frameId:e.sender.frameId}));const{tabId:l,frameId:g}=K(r.endpointName);v.set(r.endpointName,{fingerprint:r.fingerprint,port:e}),(t=O.get(r.endpointName))==null||t.forEach(s=>s()),O.delete(r.endpointName),ie(r.fingerprint,()=>{const s=$.entries().filter(n=>n.to===r.fingerprint);$.remove(s),s.forEach(n=>{n.from.endpointId==="background"?G.endTransaction(n.message.transactionId):M(n.from.endpointId).withFingerprint(n.from.fingerprint).aboutSessionEnded(r.fingerprint)})}),e.onDisconnect.addListener(()=>{var s,n;((s=v.get(r.endpointName))==null?void 0:s.fingerprint)===r.fingerprint&&v.delete(r.endpointName),(n=q.get(r.fingerprint))==null||n.forEach(o=>o()),q.delete(r.fingerprint)}),e.onMessage.addListener(s=>{var n,o;if(s.type==="sync"){const c=[...v.values()].map(u=>u.fingerprint),x=s.pendingResponses.filter(u=>c.includes(u.to));$.add(...x),s.pendingResponses.filter(u=>!c.includes(u.to)).forEach(u=>M(r.endpointName).withFingerprint(r.fingerprint).aboutSessionEnded(u.to)),s.pendingDeliveries.forEach(u=>M(r.endpointName).withFingerprint(r.fingerprint).whenDeliverableTo(u));return}s.type==="deliver"&&((o=(n=s.message)==null?void 0:n.origin)!=null&&o.context)&&(s.message.origin.tabId=l,s.message.origin.frameId=g,G.handleMessage(s.message))})});Ce(G);const Me="网络连接异常，请稍后重试！";function Pe(e){e.data===void 0&&(e.data={}),e.method=e.method||"post";let t={},r=null;e.formData?(r=new FormData,Object.keys(e.data).forEach(g=>{r.append(g,e.data[g])})):(t={"Content-Type":"application/json;charset=UTF-8"},r=JSON.stringify(e.data.value));let l={method:e.method,headers:t,body:r};fetch(e.url,l).then(g=>g.json()).then(g=>{e.done&&e.done(),e.success&&e.success(g)}).catch(g=>{e.done&&e.done(),e.fail&&e.fail(Me)})}chrome.tabs.onActivated.addListener(e=>{});chrome.runtime.onMessage.addListener((e,t,r)=>(chrome.tabs.query({active:!0,currentWindow:!0},l=>{const{contentRequest:g}=e;if(g==="apiRequest"){let{config:s}=e;s.success=n=>{n.result="succ",r(n)},s.fail=n=>{r({result:"fail",msg:n})},Pe(s)}}),!0));
