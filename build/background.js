"use strict";var le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z={exports:{}};const me=e=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const n=crypto.getRandomValues(new Uint8Array(1))[0];return(n>=e?n%e:n).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),re=(e=7,n=!1)=>Array.from({length:e},me(n?16:36)).join("");Z.exports=re;Z.exports.default=re;var ce=Z.exports;const W=ee(ce);var de=()=>`uid::${W(7)}`,Ae=(e,n=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&n.every(r=>r in e),ue=e=>{try{const n=JSON.parse(e);return Ae(n)?n:null}catch{return null}},fe=()=>{let e=[];return{add:(...n)=>{e=[...e,...n]},remove:n=>{e=typeof n=="string"?e.filter(r=>r.message.transactionId!==n):e.filter(r=>!n.includes(r))},entries:()=>e}},F=class{static toBackground(e,n){return e.postMessage(n)}static toExtensionContext(e,n){return e.postMessage(n)}},pe=Object.defineProperty,xe=Object.defineProperties,be=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,he=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,X=(e,n,r)=>n in e?pe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,T=(e,n)=>{for(var r in n||(n={}))he.call(n,r)&&X(e,r,n[r]);if(Q)for(var r of Q(n))ye.call(n,r)&&X(e,r,n[r]);return e},H=(e,n)=>xe(e,be(n)),we=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,K=e=>{const[,n,r,m]=e.match(we)||[];return{context:n,tabId:+r,frameId:m?+m:void 0}},B=({context:e,tabId:n,frameId:r})=>["background","popup","options"].includes(e)?e:`${e}@${n}${r?`.${r}`:""}`;const ve=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],J=Symbol(".toJSON was called"),_e=e=>{e[J]=!0;const n=e.toJSON();return delete e[J],n},ne=({from:e,seen:n,to_:r,forceEnumerable:m,maxDepth:g,depth:o})=>{const t=r||(Array.isArray(e)?[]:{});if(n.push(e),o>=g)return t;if(typeof e.toJSON=="function"&&e[J]!==!0)return _e(e);for(const[s,c]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(c)){t[s]="[object Buffer]";continue}if(c!==null&&typeof c=="object"&&typeof c.pipe=="function"){t[s]="[object Stream]";continue}if(typeof c!="function"){if(!c||typeof c!="object"){t[s]=c;continue}if(!n.includes(e[s])){o++,t[s]=ne({from:e[s],seen:[...n],forceEnumerable:m,maxDepth:g,depth:o});continue}t[s]="[Circular]"}}for(const{property:s,enumerable:c}of ve)typeof e[s]=="string"&&Object.defineProperty(t,s,{value:e[s],enumerable:m?!0:c,configurable:!0,writable:!0});return t};function Ee(e,n={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=n;return typeof e=="object"&&e!==null?ne({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}let te=()=>({events:{},emit(e,...n){(this.events[e]||[]).forEach(r=>r(...n))},on(e,n){return(this.events[e]=this.events[e]||[]).push(n),()=>this.events[e]=(this.events[e]||[]).filter(r=>r!==n)}});var Ce=(e,n,r)=>{const m=W(),g=new Map,o=new Map,t=s=>{if(s.destination.context===e&&!s.destination.frameId&&!s.destination.tabId){r==null||r(s);const{transactionId:c,messageID:x,messageType:u}=s,_=()=>{const h=g.get(c);if(h){const{err:f,data:S}=s;if(f){const y=f,L=self[y.name],j=new(typeof L=="function"?L:Error)(y.message);for(const R in y)j[R]=y[R];h.reject(j)}else h.resolve(S);g.delete(c)}},k=async()=>{let h,f,S=!1;try{const y=o.get(x);if(typeof y=="function")h=await y({sender:s.origin,id:x,data:s.data,timestamp:s.timestamp});else throw S=!0,new Error(`[webext-bridge] No handler registered in '${e}' to accept messages with id '${x}'`)}catch(y){f=y}finally{if(f&&(s.err=Ee(f)),t(H(T({},s),{messageType:"reply",data:h,origin:{context:e,tabId:null},destination:s.origin,hops:[]})),f&&!S)throw h}};switch(u){case"reply":return _();case"message":return k()}}return s.hops.push(`${e}::${m}`),n(s)};return{handleMessage:t,endTransaction:s=>{const c=g.get(s);c==null||c.reject("Transaction was ended before it could complete"),g.delete(s)},sendMessage:(s,c,x="background")=>{const u=typeof x=="string"?K(x):x,_="Bridge#sendMessage ->";if(!u.context)throw new TypeError(`${_} Destination must be any one of known destinations`);return new Promise((k,h)=>{const f={messageID:s,data:c,destination:u,messageType:"message",transactionId:W(),origin:{context:e,tabId:null},hops:[],timestamp:Date.now()};g.set(f.transactionId,{resolve:k,reject:h});try{t(f)}catch(S){g.delete(f.transactionId),h(S)}})},onMessage:(s,c)=>(o.set(s,c),()=>o.delete(s))}},N=class{constructor(e,n){this.endpointRuntime=e,this.streamInfo=n,this.emitter=te(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},N.initDone||(e.onMessage("__crx_bridge_stream_transfer__",r=>{const{streamId:m,streamTransfer:g,action:o}=r.data,t=N.openStreams.get(m);t&&!t.isClosed&&(o==="transfer"&&t.emitter.emit("message",g),o==="close"&&(N.openStreams.delete(m),t.handleStreamClose()))}),N.initDone=!0),N.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:e,action:"transfer"},this.streamInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,n){const r=this.emitter.on(e,n);return Object.assign(r,{dispose:r,close:r})}},U=N;U.initDone=!1;U.openStreams=new Map;var Se=e=>{const n=new Map,r=new Map,m=te();e.onMessage("__crx_bridge_stream_open__",t=>new Promise(s=>{const{sender:c,data:x}=t,{channel:u}=x;let _=!1,k=()=>{};const h=()=>{const f=r.get(u);typeof f=="function"?(f(new U(e,H(T({},x),{endpoint:c}))),_&&k(),s(!0)):_||(_=!0,k=m.on("did-change-stream-callbacks",h))};h()}));async function g(t,s){if(n.has(t))throw new Error("webext-bridge: A Stream is already open at this channel");const c=typeof s=="string"?K(s):s,x={streamId:W(),channel:t,endpoint:c},u=new U(e,x);return u.onClose(()=>n.delete(t)),await e.sendMessage("__crx_bridge_stream_open__",x,c),n.set(t,u),u}function o(t,s){if(r.has(t))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");r.set(t,s),m.emit("did-change-stream-callbacks")}return{openStream:g,onOpenStreamChannel:o}},se={exports:{}};(function(e,n){(function(r,m){m(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:le,function(r){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const m="The message port closed before a response was received.",g="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",o=t=>{const s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(s).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(a,d=void 0){super(d),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const x=i=>i&&typeof i=="object"&&typeof i.then=="function",u=(i,a)=>(...d)=>{t.runtime.lastError?i.reject(new Error(t.runtime.lastError.message)):a.singleCallbackArg||d.length<=1&&a.singleCallbackArg!==!1?i.resolve(d[0]):i.resolve(d)},_=i=>i==1?"argument":"arguments",k=(i,a)=>function(A,...b){if(b.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${_(a.minArgs)} for ${i}(), got ${b.length}`);if(b.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${_(a.maxArgs)} for ${i}(), got ${b.length}`);return new Promise((w,E)=>{if(a.fallbackToNoCallback)try{A[i](...b,u({resolve:w,reject:E},a))}catch(l){console.warn(`${i} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),A[i](...b),a.fallbackToNoCallback=!1,a.noCallback=!0,w()}else a.noCallback?(A[i](...b),w()):A[i](...b,u({resolve:w,reject:E},a))})},h=(i,a,d)=>new Proxy(a,{apply(A,b,w){return d.call(b,i,...w)}});let f=Function.call.bind(Object.prototype.hasOwnProperty);const S=(i,a={},d={})=>{let A=Object.create(null),b={has(E,l){return l in i||l in A},get(E,l,C){if(l in A)return A[l];if(!(l in i))return;let p=i[l];if(typeof p=="function")if(typeof a[l]=="function")p=h(i,i[l],a[l]);else if(f(d,l)){let P=k(l,d[l]);p=h(i,i[l],P)}else p=p.bind(i);else if(typeof p=="object"&&p!==null&&(f(a,l)||f(d,l)))p=S(p,a[l],d[l]);else if(f(d,"*"))p=S(p,a[l],d["*"]);else return Object.defineProperty(A,l,{configurable:!0,enumerable:!0,get(){return i[l]},set(P){i[l]=P}}),p;return A[l]=p,p},set(E,l,C,p){return l in A?A[l]=C:i[l]=C,!0},defineProperty(E,l,C){return Reflect.defineProperty(A,l,C)},deleteProperty(E,l){return Reflect.deleteProperty(A,l)}},w=Object.create(i);return new Proxy(w,b)},y=i=>({addListener(a,d,...A){a.addListener(i.get(d),...A)},hasListener(a,d){return a.hasListener(i.get(d))},removeListener(a,d){a.removeListener(i.get(d))}}),L=new c(i=>typeof i!="function"?i:function(d){const A=S(d,{},{getContent:{minArgs:0,maxArgs:0}});i(A)});let j=!1;const R=new c(i=>typeof i!="function"?i:function(d,A,b){let w=!1,E,l=new Promise(D=>{E=function(I){j||(console.warn(g,new Error().stack),j=!0),w=!0,D(I)}}),C;try{C=i(d,A,E)}catch(D){C=Promise.reject(D)}const p=C!==!0&&x(C);if(C!==!0&&!p&&!w)return!1;const P=D=>{D.then(I=>{b(I)},I=>{let V;I&&(I instanceof Error||typeof I.message=="string")?V=I.message:V="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:V})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return P(p?C:l),!0}),ae=({reject:i,resolve:a},d)=>{t.runtime.lastError?t.runtime.lastError.message===m?a():i(new Error(t.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?i(new Error(d.message)):a(d)},Y=(i,a,d,...A)=>{if(A.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${_(a.minArgs)} for ${i}(), got ${A.length}`);if(A.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${_(a.maxArgs)} for ${i}(), got ${A.length}`);return new Promise((b,w)=>{const E=ae.bind(null,{resolve:b,reject:w});A.push(E),d.sendMessage(...A)})},ge={devtools:{network:{onRequestFinished:y(L)}},runtime:{onMessage:y(R),onMessageExternal:y(R),sendMessage:Y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},z={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":z},services:{"*":z},websites:{"*":z}},S(t,ge,s)};r.exports=o(chrome)}else r.exports=globalThis.browser})})(se);var Ie=se.exports;const ke=ee(Ie);var $=fe(),v=new Map,O=new Map,q=new Map,oe=(e,n)=>(O.set(e,(O.get(e)||new Set).add(n)),()=>{const r=O.get(e);r!=null&&r.delete(n)&&(r==null?void 0:r.size)===0&&O.delete(e)}),ie=(e,n)=>{q.set(e,(q.get(e)||new Set).add(n))},M=e=>({withFingerprint:n=>{const r=g=>({and:()=>g}),m={aboutIncomingMessage:g=>{const o=v.get(e);return F.toExtensionContext(o.port,{status:"incoming",message:g}),r(m)},aboutSuccessfulDelivery:g=>{const o=v.get(e);return F.toExtensionContext(o.port,{status:"delivered",receipt:g}),r(m)},aboutMessageUndeliverability:(g,o)=>{const t=v.get(e);return(t==null?void 0:t.fingerprint)===n&&F.toExtensionContext(t.port,{status:"undeliverable",resolvedDestination:g,message:o}),r(m)},whenDeliverableTo:g=>{const o=()=>{const t=v.get(e);if((t==null?void 0:t.fingerprint)===n&&v.has(g))return F.toExtensionContext(t.port,{status:"deliverable",deliverableTo:g}),!0};if(!o()){const t=oe(g,o);ie(n,t)}return r(m)},aboutSessionEnded:g=>{const o=v.get(e);return(o==null?void 0:o.fingerprint)===n&&F.toExtensionContext(o.port,{status:"terminated",fingerprint:g}),r(m)}};return m}}),Te=de(),G=Ce("background",e=>{var n;if(e.origin.context==="background"&&["content-script","devtools "].includes(e.destination.context)&&!e.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const r=B(T(T({},e.origin),e.origin.context==="window"&&{context:"content-script"})),m=B(H(T(T({},e.destination),e.destination.context==="window"&&{context:"content-script"}),{tabId:e.destination.tabId||e.origin.tabId}));e.destination.tabId=null,e.destination.frameId=null;const g=()=>v.get(m),o=()=>v.get(r),t=()=>{var s;M(m).withFingerprint(g().fingerprint).aboutIncomingMessage(e);const c={message:e,to:g().fingerprint,from:{endpointId:r,fingerprint:(s=o())==null?void 0:s.fingerprint}};e.messageType==="message"&&$.add(c),e.messageType==="reply"&&$.remove(e.messageID),o()&&M(r).withFingerprint(o().fingerprint).aboutSuccessfulDelivery(c)};(n=g())!=null&&n.port?t():e.messageType==="message"&&(e.origin.context==="background"?oe(m,t):o()&&M(r).withFingerprint(o().fingerprint).aboutMessageUndeliverability(m,e).and().whenDeliverableTo(m))},e=>{const n=B(T(T({},e.origin),e.origin.context==="window"&&{context:"content-script"})),r=v.get(n),m={message:e,to:Te,from:{endpointId:n,fingerprint:r.fingerprint}};M(n).withFingerprint(r.fingerprint).aboutSuccessfulDelivery(m)});ke.runtime.onConnect.addListener(e=>{var n;const r=ue(e.name);if(!r)return;r.endpointName||(r.endpointName=B({context:"content-script",tabId:e.sender.tab.id,frameId:e.sender.frameId}));const{tabId:m,frameId:g}=K(r.endpointName);v.set(r.endpointName,{fingerprint:r.fingerprint,port:e}),(n=O.get(r.endpointName))==null||n.forEach(o=>o()),O.delete(r.endpointName),ie(r.fingerprint,()=>{const o=$.entries().filter(t=>t.to===r.fingerprint);$.remove(o),o.forEach(t=>{t.from.endpointId==="background"?G.endTransaction(t.message.transactionId):M(t.from.endpointId).withFingerprint(t.from.fingerprint).aboutSessionEnded(r.fingerprint)})}),e.onDisconnect.addListener(()=>{var o,t;((o=v.get(r.endpointName))==null?void 0:o.fingerprint)===r.fingerprint&&v.delete(r.endpointName),(t=q.get(r.fingerprint))==null||t.forEach(s=>s()),q.delete(r.fingerprint)}),e.onMessage.addListener(o=>{var t,s;if(o.type==="sync"){const c=[...v.values()].map(u=>u.fingerprint),x=o.pendingResponses.filter(u=>c.includes(u.to));$.add(...x),o.pendingResponses.filter(u=>!c.includes(u.to)).forEach(u=>M(r.endpointName).withFingerprint(r.fingerprint).aboutSessionEnded(u.to)),o.pendingDeliveries.forEach(u=>M(r.endpointName).withFingerprint(r.fingerprint).whenDeliverableTo(u));return}o.type==="deliver"&&((s=(t=o.message)==null?void 0:t.origin)!=null&&s.context)&&(o.message.origin.tabId=m,o.message.origin.frameId=g,G.handleMessage(o.message))})});Se(G);chrome.runtime.onInstalled.addListener(()=>{chrome.action.disable(),chrome.declarativeContent.onPageChanged.removeRules(void 0,()=>{const n=[{conditions:[new chrome.declarativeContent.PageStateMatcher({pageUrl:{hostSuffix:".ylands.ied.com"}})],actions:[new chrome.declarativeContent.ShowPageAction]}];chrome.declarativeContent.onPageChanged.addRules(n)})});chrome.tabs.onActivated.addListener(e=>{});
